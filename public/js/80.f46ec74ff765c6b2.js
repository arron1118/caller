"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[80],{3744:(e,t)=>{t.Z=(e,t)=>{const n=e.__vccOpts||e;for(const[e,o]of t)n[e]=o;return n}},4080:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var o=n(4865);var r=Object.defineProperty,a=Object.defineProperties,i=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,d=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;const u=e=>e+"_"+(Date.now()+Math.floor(1e6*Math.random())),p=()=>{const e="undefined"!=typeof window?window:n.g;return e&&"tinymce"in e?e.tinymce:null};function m(e){return e?e.getContent():""}function f(e,t){t&&t.setContent(e)}function g(e,t=!0){e&&e.mode.set(t?"readonly":"design")}function y(e,t,n,o,r){let a,i,{images_upload_url:l,images_upload_credentials:s,custom_images_upload_header:d,custom_images_upload_param:c,custom_images_upload_callback:u}=e||{};a=new XMLHttpRequest,a.withCredentials=!!s,a.open("POST",l||""),d&&Object.keys(d).forEach((e=>{a.setRequestHeader(e,d[e])})),a.upload.onprogress=function(e){r(e.loaded/e.total*100)},a.onload=function(){if(403===a.status)return void o("HTTP Error (custom): status "+a.status,{remove:!0});if(a.status<200||a.status>=300)return void o("HTTP Error (custom): status "+a.status);let e=JSON.parse(a.responseText);if(!e)return void o("Invalid JSON (custom): "+a.responseText);let t="function"==typeof u?u(e):e.location;t?n(t):o("Failed Path (custom): location image path is error/empty")},a.onerror=function(){o("Image upload failed due to a XHR Transport error. Code: "+a.status)},i=new FormData,i.append("file",t.blob(),t.filename()),c&&Object.keys(c).forEach((e=>{i.append(e,c[e])})),a.send(i)}const b=(()=>{let e={status:{},loadedCallbacks:{}};const t=t=>{e.loadedCallbacks[t]&&(e.loadedCallbacks[t].forEach((e=>{"function"==typeof e.handler&&e.handler.call(e.scope)})),e.loadedCallbacks[t]=void 0)};return{load:(n,o,r)=>{o&&(e.loadedCallbacks[n]||(e.loadedCallbacks[n]=[]),e.loadedCallbacks[n].push({handler:o,scope:r||void 0})),"LOADED"!==e.status[n]?"LOADING"!==e.status[n]&&(e.status[n]="LOADING",((e,t)=>{const n=document.createElement("script");n.id=u("tiny-script"),n.type="application/javascript",n.src=e,n.referrerPolicy="origin";const o=()=>{n.removeEventListener("load",o),t()};n.addEventListener("load",o),(document.head||document.body).appendChild(n)})(n,(()=>{e.status[n]="LOADED",t(n)}))):t(n)}}})(),h=["id"],v={key:0},C=Object.assign({name:"Vue3Tinymce"},{props:{modelValue:String,setting:{type:Object,default:()=>({})},setup:Function,disabled:Boolean,scriptSrc:String,debug:Boolean},emits:["update:modelValue","init","change"],setup:function(e,{expose:t,emit:n}){const r=e;let C=!0;const k=(0,o.reactive)({editor:null,id:u("tinymce"),err:""}),O=()=>{var e;return String(null!=(e=r.modelValue)?e:"")},_=(e,t,n)=>{r.debug&&console.log(`来自：${e.type} | \n ${t} \n ${n||"--"}`)},w=()=>{if(null===p())return void(k.err="tinymce is null");r.debug&&console.warn("vue3-tinymce 进入debug模式");let e=(t=((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&c(e,n,t[n]);if(l)for(var n of l(t))d.call(t,n)&&c(e,n,t[n]);return e})({},r.setting),o={selector:"#"+k.id,setup:e=>{r.setup&&r.setup(e),e.on("init",(()=>(e=>{k.editor=e,f(O(),e),r.disabled&&"readonly"!==e.mode.get()&&g(e),e.on("change input undo redo",(t=>{((e,t)=>{t||(t=k.editor);const o=m(t);_(e,o),n("update:modelValue",o),n("change",o)})(t,e)})),n("init",e)})(e)))}},a(t,i(o)));var t,o;r.setting.custom_images_upload&&(e.images_upload_handler=(...e)=>{y.apply(null,[r.setting||{},...e])}),p().init(e),C=!1};return(0,o.watch)((()=>r.modelValue),((e,t)=>{if(k.editor&&k.editor.initialized&&t!==e&&e!==m(k.editor)){if(_({type:"propsChanged to setContent"},e,t),null===e)return function(e,t){if(t){if(t.resetContent)return t.resetContent("");t.setContent(""),t.setDirty(!1),t.undoManager.clear()}}(0,k.editor);f(O(),k.editor)}})),(0,o.watch)((()=>r.disabled),(e=>{k.editor&&k.editor.initialized&&g(k.editor,e)})),t({id:k.id,editor:k.editor}),(0,o.onMounted)((()=>{var e;if(null!==p())return void w();const t=null!=(e=r.scriptSrc)?e:"https://cdn.bootcdn.net/ajax/libs/tinymce/5.8.2/tinymce.min.js";b.load(t,w)})),(0,o.onActivated)((()=>{C||w()})),(0,o.onDeactivated)((()=>{k.editor&&k.editor.remove()})),(0,o.onBeforeUnmount)((()=>{k.editor&&k.editor.remove()})),(e,t)=>((0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)("div",{id:(0,o.unref)(k).id,class:"tiny-textarea"},null,8,h),(0,o.unref)(k).err?((0,o.openBlock)(),(0,o.createElementBlock)("p",v,(0,o.toDisplayString)((0,o.unref)(k).err),1)):(0,o.createCommentVNode)("",!0)],64))}});C.install=function(e){e.component("Vue3Tinymce",C)};const k={name:"TinyMce",components:{Vue3Tinymce:C},setup:function(e,t){return{state:(0,o.ref)({content:"hello",setting:{height:400}}),editNote:function(e){console.log(e)}}},props:[]};const O=(0,n(3744).Z)(k,[["render",function(e,t,n,r,a,i){var l=(0,o.resolveComponent)("vue3-tinymce");return(0,o.openBlock)(),(0,o.createBlock)(l,{modelValue:r.state.content,"onUpdate:modelValue":t[0]||(t[0]=function(e){return r.state.content=e}),setting:r.state.setting,onChange:r.editNote},null,8,["modelValue","setting","onChange"])}]])}}]);